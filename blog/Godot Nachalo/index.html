<!DOCTYPE html> <html lang="en"> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111024724-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-111024724-1'); </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Godot Начало</title> <meta name="description" content="В данной статье рассказывается о первых шагах в мире редактора Godot"> <link rel="canonical" href="https://murlab.github.io/blog/Godot%20Nachalo/"> <link rel="alternate" type="application/rss+xml" title="Mur Laboratory" href="/feed.xml"> <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /> <link rel="icon" type="image/png" href="/favicon.png" /> <link rel="stylesheet" type="text/css" href="/css/font-awesome.css" /> <link rel="stylesheet" type="text/css" href="/css/fonts.css" /> <link rel="stylesheet" type="text/css" href="/css/main.css" /> <script type="text/javascript" src="/js/main.js"></script> <link rel="stylesheet" href="/css/highlight/monokai-sublime.css"> <script src="/js/highlight.pack.js"></script> <script>hljs.initHighlightingOnLoad();</script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Article", "headline": "Godot Начало", "image": "https://murlab.github.io/images.posts/2018.05/16 - Godot Nachalo/title.png", "keywords": [ "godot engine", "godot 3", "gdscript", "уроки" ], "datePublished": "2018-05-16", "dateModified": "2018-05-18", "articleSection": "godot", "author": { "@type": "Person", "name": "Mur" }, "creator": { "@type": "Person", "name": "Mur" }, "publisher": { "@type": "Organization", "name": "Mur Lab", "logo":{"@type":"ImageObject", "url":"https://murlab.github.io/images/avatar.png"} }, "articleBody": "Всем привет! Давненько от меня не было слышно никаких новостей, тем более и повод соответствующий, наконец-таки поделится своими наработками по Godot, и уже аж версии 3! В этом вводном материале мы рассмотрим сам редактор, базовые элементы и немного затронем скрипты. ", "mainEntityOfPage": "True" } </script> </head> <body onload="init();"> <div class="center"> <div class="header"> <div class="topLogo"></div> <div class="topMenuAdd"> <a href="/files/" class="topMenuItem" title="Файлы для скачивания"><i class="fa fa-download" aria-hidden="true"></i></a> <a href="/feed.xml" class="topMenuItem" title="Подписаться на RSS"><i class="fa fa-rss" aria-hidden="true"></i></a> </div> </div> <div id="navbar" class="topMenu"> <div class="topMenuLeft"></div> <div class="topMenuCenter"> <span class="topMenuSpace">&nbsp;</span> <span><a href="/blog/" class="topMenuItem active"><i class="fa fa-paw" aria-hidden="true"></i><br>Блог</a></span> <span><a href="/graphics/" class="topMenuItem"><i class="fa fa-pencil" aria-hidden="true"></i><br>Графика</a></span> <span><a href="/misc/" class="topMenuItem"><i class="fa fa-code" aria-hidden="true"></i><br>Разное</a></span> <span><a href="/rpg_maker/" class="topMenuItem"><i class="fa fa-diamond" aria-hidden="true"></i><br>RPG Maker</a></span> <span><a href="/godot/" class="topMenuItem"><i class="fa fa-cogs" aria-hidden="true"></i><br>Godot</a></span> <span><a href="/about/" class="topMenuItem"><i class="fa fa-github-alt" aria-hidden="true"></i><br>Мур?</a></span> </div> <div class="topMenuRight"></div> <a href="/"><div class="topMenuAvatar"></div></a> <div class="popupMenu"> <input id="popupMenuInput" type="checkbox" name="menu"/> <label id="popupMenuLabel" for="popupMenuInput"><span class="fa fa-bars topMenuIcon" aria-hidden="true"></span></label> <ul class="menu"> <li><a href="/blog/" class="popupMenuItem active"><i class="fa fa-paw" aria-hidden="true"></i>Блог</a></li> <li><a href="/graphics/" class="popupMenuItem"><i class="fa fa-pencil" aria-hidden="true"></i>Графика</a></li> <li><a href="/misc/" class="popupMenuItem"><i class="fa fa-code" aria-hidden="true"></i>Разное</a></li> <li><a href="/rpg_maker/" class="popupMenuItem"><i class="fa fa-diamond" aria-hidden="true"></i>RPG Maker</a></li> <li><a href="/godot/" class="popupMenuItem"><i class="fa fa-cogs" aria-hidden="true"></i>Godot</a></li> <li><a href="/about/" class="popupMenuItem"><i class="fa fa-github-alt" aria-hidden="true"></i>Мур?</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/comments/" class="popupMenuItem"><i class="fa fa-comments-o" aria-hidden="true"></i> Новые комментарии</a></li> <li><a href="https://murlab.disqus.com/latest.rss" class="popupMenuItem"><i class="fa fa-rss" aria-hidden="true"></i> RSS комментариев</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/archive/" class="popupMenuItem"><i class="fa fa-archive" aria-hidden="true"></i> Архив постов</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/files/" class="popupMenuItem"><i class="fa fa-cloud-download" aria-hidden="true"></i> Cкачать файлы</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/tags/" class="popupMenuItem"><i class="fa fa-tags" aria-hidden="true"></i> Все тэги</a></li> <li><a href="/feed.xml" class="popupMenuItem"><i class="fa fa-rss" aria-hidden="true"></i> RSS лента</a></li> </ul> </div> </div> <div class="content"> <div class="post"> <div class="postHeader"> <div class="postStar"><i class="fa fa-gear" aria-hidden="true"></i></div> <div class="postDate"> 16 Мая 2018 </div> <div class="postTitle">Godot Начало</div> </div> <div class="postContent"> <div class="postImage"> <img src="/images.posts/2018.05/16 - Godot Nachalo/title.png" /> </div> <div class="postBody"> <p>Всем привет!</p> <p>Давненько от меня не было слышно никаких новостей, тем более и повод соответствующий, наконец-таки поделится своими наработками по Godot, и уже аж версии 3!</p> <p>В этом вводном материале мы рассмотрим сам редактор, базовые элементы и немного затронем скрипты.</p> <p>Скачать редактор можно как с <a href="https://godotengine.org/download/windows">официального сайта</a>, так и установив через клиент <a href="https://store.steampowered.com/">Steam</a> (кому как удобнее).</p> <p>Я буду использовать <a href="https://store.steampowered.com/app/404790/Godot_Engine/">версию из Steam</a>, так как она позволяет одновременно работать как с версией 3, так и запускать версию 2.1. Забегая вперёд скажу, что в третьей версии очень многое поменялось, некоторая логика, вызовы в скриптах и т.д. Но обо всём по порядку.</p> <p>После запуска Godot, вы увидите окошко со списком доступных проектов. Их можно как запустить сразу, нажав кнопку «Запустить», так и открыть в редакторе, соответственно кнопка «Редактировать».</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/01.png" class="imgCenter" /></p> <p>Примеры проектов можно скачать с <a href="https://godotengine.org/showcase">сайта Godot</a>. Однако сразу обращу ваше внимание, что проекты, написанные под Godot 2.1 с большей долей вероятности не заработают из отличия в скриптах. Поэтому, при скачивании, обратите внимание на версию.</p> <p>После того как вы скачали и распаковали архив в какую-нибудь папку на диске, её нужно подключить к редактору. Нажимаем кнопку «Импорт», указываем путь, и нажимаем «Импортировать и Редактировать», после чего наши демо-проекты появятся в списке доступных.</p> <p>Так же демо-проекты можно посмотреть, выбрав вкладку «Шаблоны». Выбираем заинтересовавший нас проект, например, «2D Particles Demo». Нажимаем на название, и во вновь открывшемся окне устанавливаем (кнопка «Установить»).</p> <p>По сути можно сразу посмотреть проект в действии, кнопкой «Запустить». Однако может быть ситуация, как с «2D Particles Demo», когда для просмотра нужно его сначала всё-так открыть в редакторе для импорта некоторых компонентов.</p> <p>Думаю, с демо-примерами вы разберётесь самостоятельно, а мы создадим новый проект, нажав соответствующую кнопку. В вновь открывшемся окне у нас спросят название проекта и где мы хотим его разместить (пустая папка).</p> <p>Несмотря на то, что редактор Godot русифицирован, я всё же рекомендую задавать имена файлов латинскими буквами, дабы избежать проблем в будущем и не ломать голову почему у меня вылетают непонятные ошибки или вовсе не грузится, например, картинка.</p> <p>После создания проекта, у нас откроется сам редактор. Он состоит из нескольких блоков: Блок «Файловая система» — здесь располагаются блок навигации (дерево папок) и собственно все файлы нашего проекта; Блок «Сцена» — это структура (дерево) всех наших элементов на текущей сцене; Блок «Инспектор» — позволяет редактировать свойства и параметры выбранного элемента в дереве блока «Сцена».</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/02.png" class="imgCenter" /></p> <p>Ещё есть блоки «Импорт» и «Узел», но мы пока рассматривать их не будем.</p> <p>По центру расположен сам редактор, в зависимости от того что мы хотим редактировать он может отображать 2D-сцену, 3D-сцену, редактор скриптов, а также список доступных модулей (плагинов для самого Godot) — «AssetLib». Переключаются разделы нажатием на соответствующие надписи в верхней части.</p> <p>В нижней части редактора есть ещё один блок, который по умолчанию скрыт, и открывается только при возникновении каких-либо ошибок или отладке. Он состоит из четырёх вкладок: «Вывод» — различная информация самого редактора, в том числе ошибки; «Отладчик» — используется для отладки скриптов; «Аудио» и «Анимация» мы пока рассматривать не будем.</p> <p>Для того, чтобы скрыть это блок опять, достаточно нажать ещё раз на название раздела («Вывод», «Отладчик», «Аудио» или «Анимация»).</p> <p>Но вернёмся к редактору, по своей сути все элементы Godot это сцены, их можно сохранять, изменять тип, встраивать в другие сцены и т.д. Мы будем работать с 2D-сценами и использовать соответствующие для них типы элементов.</p> <p>Сначала создадим простой компонент, который будет у нас в будущем игроком. Для этого в блоке «Сцена» нажимаем плюс и во вновь открывшемся окошке ищем тип «KinematicBody2D» с иконкой в виде человечка. Его можно сразу найти задав фильтр в строке поиска или найти открыв дерево со списком компонентов: Node → CanvasItem → Node2D → CollisionObject2D → PhysicsBody2D → KinematicBody2D. После чего нажимаем кнопку «Создать».</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/03.png" class="imgCenter" /></p> <p>По своей сути мы могли бы выбрать и обычный элемент «Node2D», но у «KinematicBody2D» есть ряд свойств, которые нам понадобятся в будущем.</p> <p>После добавления элемента на сцену, рядом с названием появится желтый восклицательный знак, нажав на пиктограмму которого мы получим предупреждение:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/04.png" class="imgCenter" /></p> <p>Дело в том, что для того что бы наш игрок смог взаимодействовать с пространством у него должна быть задана область взаимодействия, ну и заодно нужно задать внешний вид игрока.</p> <p>Для начала переименуем наш компонент «KinematicBody2D» в «player». В последствии это имя будет использовано при отображении элементов на игровой сцене. (Для этого достаточно кликнуть на названии и откроется поле для ввода нового имени).</p> <p>Теперь необходимо добавить компонент, отвечающий за область взаимодействия или если быть точнее область обнаружения столкновений (Collision). Если у нас простой элемент или мы не хотим заморачиваться с высокой точностью, то подойдёт «CollisionShape2D». Если же у вас сложный, многогранный объект, то можно выбрать «CollisionPolygon2D».</p> <p>Я не буду усложнять материал, поэтому просто добавим компонент «CollisionShape2D». Выбираем наш элемент «player», нажимаем плюс и выбираем: Node → CanvasItem → Node2D → CollisionShape2D.</p> <p>И вновь получаем предупреждение с желтым восклицательным знаком:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/05.png" class="imgCenter" /></p> <p>Дело в том, что компонент мы добавили, а сама область так и не задана. Но прежде чем мы её добавим, нам понадобится ещё один элемент — Sprite. Это будет внешний вид нашего персонажа.</p> <p>Выбираем узел «player», нажимаем плюс и добавляем: Node → CanvasItem → Node2D → Sprite:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/06.png" class="imgCenter" /></p> <p>Как видите, в разделе «Недавние», появились наши ранее добавленные элементы. Гораздо быстрее, нежели искать однотипные элементы каждый раз.</p> <p>Теперь переключимся в блок «Файловая система», и нажав правую кнопку мыши на «res://» выберем пункт «Новая папка». В открывшемся окне введём название «images», здесь будут изображения, которые мы будет использовать в дальнейшем:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/07.png" class="imgCenter" /></p> <p>Откроем эту папку в проводнике (правая кнопка мыши на «images» и пункт «Просмотреть в проводнике». Теперь сюда нужно скопировать картинку для нашего игрока в формате PNG.</p> <p>Хочу обратить ваше внимание, что PhotoShop очень любит «пихать» в файлы системную информацию, и в частности задавать не совсем корректный «Color profile». Из-за чего Godot начнёт ругаться на некорректный формат «sRGB profile»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/08.png" class="imgCenter" /></p> <p>В принципе вы конечно можете игнорировать данное сообщение, но я всё рекомендую очистить весь лишний «мусор». Сделать это можно, например, с помощью программы «<a href="https://www.xnview.com/en/xnviewmp/">XnView MP</a>». Для этого на нашей картинке нажимаем правую кнопку мыши и в открывшемся меню выбираем «Пакетная обработка»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/09.png" class="imgCenter" /></p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/10.png" class="imgCenter" /></p> <p>На вкладке действия нажимаем «Добавить действие» → Изображение → Удаление метаданных. Отмечаем все чекбоксы (галочки) и нажимаем преобразовать:</p> <p>После чего редактор Godot успокоится и перестанет ругаться на некорректный профиль. Честно сказать я не знаю с чем это связано, ибо такая же ситуация была и с версией 2.1. Возможно в будущем я разберусь подробнее с этим моментом.</p> <p>Но вернёмся в наш редактор и убедимся, что изображение нашего игрока находится на месте. Теперь это изображение нужно добавить к компоненту Sprite. Для этого выберем этот элемент в разделе «Сцена», и переключим своё внимание на раздел «Инспектор». В данный момент нас интересует свойство «Texture». Изначально там указано значение <Null>. Нас интересует «Новый ImageTexture». Можно выбрать его из меню, а можно сразу перетащить нашу картинку из блока «Файловая система» и отпустить над свойством «Texture»:</Null></p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/11.png" class="imgCenter" /></p> <p>После чего увидим, что в главном окне редактора у нашего «player» появилась форма в виде нашей картинки:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/12.png" class="imgCenter" /></p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/13.png" class="imgCenter" /></p> <p>Сразу хочу обратить ваше внимание вот на какой момент. Если вы планируете использовать графику в стиле pixeart, то вам вполне вероятно понадобится отключить сглаживание. В противном случае ваша картинка будет «мутная».</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/14.png" class="imgCenter" /></p> <p>Для этого, в блоке «Инспектор», выбираем нашу текстуру, и в открывшемся меню выбираем пункт «Редактировать»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/15.png" class="imgCenter" /></p> <p>В разделе «Flags» снимаем все чекбоксы (галочки) и убеждаемся, что грани нашего кубика больше не сглаживаются.</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/16.png" class="imgCenter" /></p> <p>Для того, чтобы не повторять эту процедуру каждый раз, откроем блок «Импорт», снимем чекбокс (галочку) напротив «Flags». Затем нажимаем на «Предустановка..» и выбираем «Установить по умолчанию для ‘Texture’»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/17.png" class="imgCenter" /></p> <p>Теперь при импорте новых картинок редактор не будет выставлять флаги.</p> <p>Вернёмся к блоку «Сцена» и добавим наконец область взаимодействия. Для этого выберем наш компонент «CollisionShape2D» и блоке «Инспектор» зададим свойство «Shape» в виде «Новый RectangleShape2D»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/18.png" class="imgCenter" /></p> <p>Просто квадратная область. Поскольку изображение нашего игрока всего 32 на 32 точки, то область задать будет несколько проблематично:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/19A.png" class="imgCenter" /></p> <p>Но можно с помощью колеса мыши приблизить изображение и выставить область таким образом, чтобы она покрывала весь спрайт персонажа:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/19B.png" class="imgCenter" /></p> <p>Можно пойти несколько другим способом и не мучатся, тягая мышкой точки. Открываем в блоке «Инспектор» раздел «Transform» и задаём свойство Scale:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/20.png" class="imgCenter" /></p> <p>Честно сказу в редакторе Godot очень много непонятных моментов, например, почему свойство именно scale (масштаб), а ни, например, просто дать возможность указать точный размер области. Или глобальная область первичного объекта (в данном случае «player») она равна 64 на 64 точки и изменить её нельзя, даже если у нас спрайт размером меньше. Честно скажу это весьма неудобно в некоторых случаях. А на англоязычных форумах предлагают модифицировать основные классы прямо внутри Godot и задавать там размер. К сожалению, с ходу у меня это не получилось сделать.</p> <p>Но вернёмся к нашему игроку. По сути базовые настройки завершены, и мы можем сохранить нашу сцену уже как компонент «player». Для этого в блоке «Файловая система» создадим ещё одну папку и назовём её «elements». Теперь в главном меню редактора выберем «Сцена» → «Сохранить сцену как…» и выбрав нашу папку «elements» сохраним файл «player.tscn»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/21.png" class="imgCenter" /></p> <p>Теперь нам нужно создать главную игровую сцену. Для этого в том же главном меню «Сцена» выбираем пункт «Новая сцена». В блоке «Сцена» нажимаем плюс и выбираем компоненту «Node»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/22.png" class="imgCenter" /></p> <p>По сути это базовый компонент, прародитель всех остальных и нам от него ничего не потребуется (пока). Единственное, что переименуем его в «gamescene». Теперь нам на игровую сцену нам нужно добавить нашего игрока. Для этого кликнем на «gamescene» и затем нажмём на пиктограмму в виде звена цепи (рядом с плюсом) и во вновь открывшемся окне выберем: «elements → player.tscn».</p> <p>Как не трудно догадаться звено цепи прикрепляет к сцене элемент в виде нашего игрока. Причём если мы потом захотим что-либо изменить в «player», то этим изменения так же отобразятся на игровой сцене. Это очень удобно, так как таких элементов может быть очень много на сцене и отдельно редактировать каждый из компонентов очень утомительно.</p> <p>Компонент «player» можно спокойно перемещать мышкой в нужное место, но мы пойдём немного дальше и включим сетку и сделаем перемещение дискретное. Для этого в основном блоке редактора нажмём обзор и включим «Показать сетку». По сути её можно в любой момент включать/отключать с помощь горячих клавиш — G:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/23.png" class="imgCenter" /></p> <p>Теперь настроим размер ячеек кратное нашему игроку. Для этого нажмём на пиктограмму в виде трёх вертикальных точек и выберем пункт «Настроить привязку…»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/24A.png" class="imgCenter" /></p> <p>И укажем размер ячеек 32 на 32:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/24B.png" class="imgCenter" /></p> <p>Теперь надо активировать привязку нажав на пиктограмму в виде магнита:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/25.png" class="imgCenter" /></p> <p>Так же можно переключать это режим с помощью горячей клавиши — S.</p> <p>Как мы видим на скриншоте выше наш игрок попадает на пересечение ячеек и это не есть совсем хорошо:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/26.png" class="imgCenter" /></p> <p>Для того что бы наш персонаж был чётко посредине ячейки, откроем его на редактирование нажав на пиктограмму в виде «Хлопушки-нумератора»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/27.png" class="imgCenter" /></p> <p>Теперь изменим свойства позиционирования в блоке «Инспектор», сначала для Srpite:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/28.png" class="imgCenter" /></p> <p>В подразделе «Offset» снимаем чекбокс (галочку) рядом со свойством «Centered».</p> <p>Затем у элемента «CollisionShape2D» в подразделе «Position» задаём смещение (16, 16) на половину размера нашего спрайта:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/29.png" class="imgCenter" /></p> <p>Сохраняем сцену (Ctrl+S) с «player.tscn» и переключаемся на нашу игровую сцену:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/30.png" class="imgCenter" /></p> <p>Проверяем, что наш персонаж точно по середине ячейки, хоть и общий контур больше (64x64) и сохраним игровую сцену. Создадим ещё одну папку «scenes» в «res://» и сохраним туда «gamescene.tscn».</p> <p>Теперь самое время проверить всю нашу конструкцию в действии. Для этого выберем в верхнем меню справа нажмём кнопку «play» или горячую клавишу — «F5».</p> <p>Редактор сообщит, что не выбрана главная сцена и предложит её указать. Нажимаем «Выделение» и выбираем «gamescene.tscn»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/31.png" class="imgCenter" /></p> <p>После чего откроется окно с игрой, и мы увидим наш квадратик с персонажем.</p> <p>Теперь попробуем задать управление с помощью клавиатуры и рассмотрим базовые элементы скриптов. Сначала нам нужно задать сами клавиши.</p> <p>Для этого откроем в главном меню: «Проект» → «Параметры проекта». Во вновь открывшемся окне на закладке «Список действий» мы увидим большой список. Можно использовать уже готовые элементы списка, но мы создадим четыре своих: «player_up», «player_down», «player_left», «player_right». Вставляем поочерёдно названия и нажимаем кнопку «Добавить»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/32A.png" class="imgCenter" /></p> <p>Это будут четыре события, по каждой стороне перемещения. Теперь надо задать условия, при котором будет происходить сработка события. Нажимаем плюс и выбираем «кнопка», после чего откроется окошко и нам предложат нажать кнопку на клавиатуре. По такому же принципу можно задать кнопку у геймпада или мыши:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/32B.png" class="imgCenter" /></p> <p>Я буду нажимать кнопки управления курсором, но вы можете назначить их по своему усмотрению, например, WASD. В результате чего должна получится такая вот картина:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/33.png" class="imgCenter" /></p> <p>Теперь создадим ещё одну папку в разделе «res://» для скриптов — «scripts». После чего открываем на редактирование нашу сцену «player.tscn». Выбираем главный узел «player» и нажимаем пиктограмму в виде свитка с зелёным плюсиком или же можно нажать правую кнопку на узле «player» и выбрать «Прикрепить скрипт»:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/34.png" class="imgCenter" /></p> <p>Во вновь открывшемся окне оставляем все настройки по умолчанию, и изменим лишь наш путь к расположению скрипта, дабы не делать в будущем свалку:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/35.png" class="imgCenter" /></p> <p>После нажатия кнопки «Создать» откроется редактор с нашим скриптом, с шаблоном по умолчанию. Несколько слов о самом редакторе:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/36.png" class="imgCenter" /></p> <ul> <li>В <strong>области 1</strong> находятся открытые скрипты проекта, в данный момент он один — <em>player.gd</em>;</li> <li>В <strong>области 2</strong> находится список функций данного скрипта. На этапе создания она тоже одна это <em>_ready()</em>;</li> <li>В <strong>области 3</strong> (начало скрипта) указан класс на базе которого основан данный скрипт. В данном примере это <em>KinematicBody2D</em>. У каждого класса свой функционал и надо быть внимательным.</li> <li>В области 4 перечисляются локальные переменные доступные внутри этого скрипта. Несмотря на то, что тип переменной не указан явно (var), они типизированы и для того, чтобы склеить строку и число, придётся привести к одному типу. Например “lives: “ + String(10);</li> <li>Далее в <strong>области 5 и 6</strong> следуют функции. У зарезервированных функций имена начинаются со знака подчёркивания. В выше указанном примере функция <em>_ready()</em> вызывается 1 раз когда элемент добавляется на сцену, или проще говоря инициализируется. Если функция пустая, для того чтобы не было ошибки вставляется «заглушка» в виде вызова <em>pass</em>. Функция <em>_process</em> вызывается каждый фрейм (кадр), но только если предварительно была разрешена командой <em>set_process(true)</em> в функции <em>_ready()</em>. Причём при каждом вызове функции <em>_process</em> в переменной <em>delta</em> будет некое число (прирост) с момента предыдущего вызова. Это значение можно использовать как таймер для каких-либо действий в будущем;</li> </ul> <p>Проведём небольшой эксперимент. Разрешим вызов <em>set_process(true)</em>, а в функции <em>_process</em> добавим вывод в консоль отладки значение <em>delta</em> в консоль:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/37A.png" class="imgCenter" /></p> <p>Теперь после запуска проекта (F5) мы получим кучу быстро сменяющихся цифр:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/37B.png" class="imgCenter" /></p> <p>Ура! Всё работает! Но нам нужно добавить управление нашим кубиком. Сразу скажу, что приведённый метод не очень хорош, но как базовая демонстрация вполне сгодится. В моих проектах используется более корректный опрос, но он несколько сложен, а мне бы не хотелось перегружать и так достаточно большую статью. Итак, для того, чтобы сработал наш опрос кнопок необходимо на этапе инициализации добавить несколько переменных:</p><pre><code class="javascript">var direction = Vector2()
var speed = 0
const MAX_SPEED = 400
var velocity = Vector2()
</code></pre><ul> <li><strong><em>direction</em></strong> — это двумерный вектор направления в какую сторону будет двигаться наш персонаж: (-1,0) влево, (1,0) вправо, (0,-1) вверх, (0,1) вниз. Возможны комбинации, например, для движения по горизонтали вверх и влево (-1,-1);</li> <li><strong><em>speed</em></strong> — текущая скорость перемещения нашего персонажа, изначально равно 0 (он стоит);</li> <li><strong><em>MAX_SPEED</em></strong> — константа, максимальная скорость с которой будет двигаться персонаж;</li> <li><strong><em>velocity</em></strong> — ещё одни двумерный вектор, в нём хранится текущее направление движения с учётом скорости;</li> </ul> <p>Теперь опишем функционал в <em>_process</em>:</p> <p>Инициализируем(сбрасываем) направление движения (0,0):</p><pre><code class="Python">direction = Vector2()</code></pre><p>Теперь опрашиваем события для кнопок влево/вправо:</p><pre><code class="Python">if Input.is_action_pressed("player_left"):
	direction.x = -1
elif Input.is_action_pressed("player_right"):
	direction.x = 1 
</code></pre><p>Если одна из них нажата задаём горизонтальное направление.</p> <p>Повторяем эту же процедуру для вертикального движения:</p><pre><code class="Python">if Input.is_action_pressed("player_up"):
	direction.y = -1
elif Input.is_action_pressed("player_down"):
	direction.y = 1
</code></pre><p>Если вектор движения задан (не равен 0,0), то выставляем максимальную скорость движения, в противном случае она равна нулю:</p><pre><code class="Python">if direction != Vector2():
	speed = MAX_SPEED
else:
	speed = 0
</code></pre><p>Теперь рассчитываем движение с учётом направления и скорости:</p><pre><code class="Python">velocity = speed * direction.normalized()</code></pre><p>Ну и далее собственно заставляем двигаться сам объект:</p><pre><code class="Python">move_and_slide (velocity)</code></pre><p>В результате чего у нас должна получится вот такая картинка:</p> <p><img src="/images.posts/2018.05/16 - Godot Nachalo/38.png" class="imgCenter" /></p> <p>А после запуска наш квадратик гоняется по экрану с помощью клавиш курсора.</p> <p>На этом собственно всё. Не хочу сильно перегружать вводную часть. В следующий раз мы рассмотрим столкновения и более подробно поговорим о GDScript.</p> <p>Удачи в ваших начинания, а готовый проект можно скачать по <a href="/downloads/godot/test_01.zip">ссылке</a>.</p> <div class="postTags"> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/godot engine/">godot engine</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/godot 3/">godot 3</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/gdscript/">gdscript</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/uroki/">уроки</a></div> </div> </div> <div class="postEnd"> <div class="postEndLineStart"></div> <div class="postEndCont"><a href="javascript:history.back();"><< Назад</a></div> <div class="postEndLineFinish"></div> </div> </div> <div id="disqus_thread"></div> <script> (function() { var d = document, s = d.createElement('script'); s.src = 'https://murlab.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> <div class="centerClean"></div> </div> </div> <div class="centerEnd"><div></div></div> <div class="footer">2014, 2018 &copy; Mur Laboratory. Размещение материалов на других ресурсах только с разрешения автора.</div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111024724-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-111024724-1'); </script> </body> </html>
