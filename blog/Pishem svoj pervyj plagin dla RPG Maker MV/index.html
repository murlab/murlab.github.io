<!DOCTYPE html> <html lang="en"> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111024724-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-111024724-1'); </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Пишем свой первый плагин для RPG Maker MV</title> <meta name="description" content="В данной статье рассказывается с чего начать и как создать свой первый плагин для RPG Maker MV (Старая редакция)"> <link rel="canonical" href="https://murlab.github.io/blog/Pishem%20svoj%20pervyj%20plagin%20dla%20RPG%20Maker%20MV/"> <link rel="alternate" type="application/rss+xml" title="Mur Laboratory" href="/feed.xml"> <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /> <link rel="icon" type="image/png" href="/favicon.png" /> <link rel="stylesheet" type="text/css" href="/css/all.css" /> <link rel="stylesheet" type="text/css" href="/css/fonts.css" /> <link rel="stylesheet" type="text/css" href="/css/main.css" /> <script type="text/javascript" src="/js/main.js"></script> <link rel="stylesheet" href="/css/highlight/monokai-sublime.css"> <script src="/js/highlight.pack.js"></script> <script>hljs.initHighlightingOnLoad();</script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Article", "headline": "Пишем свой первый плагин для RPG Maker MV", "image": "https://murlab.github.io/images.posts/2015.11/05 - Pishem svoj pervyj plagin dla RPG Maker MV/plugin_title.png", "keywords": [ "archive", "rpg maker mv", "plugins", "javascript", "story", "уроки" ], "datePublished": "2015-11-05", "dateModified": "2015-11-05", "articleSection": "rpg_maker", "author": { "@type": "Person", "name": "Mur" }, "creator": { "@type": "Person", "name": "Mur" }, "publisher": { "@type": "Organization", "name": "Mur Lab", "logo":{"@type":"ImageObject", "url":"https://murlab.github.io/images/avatar.png"} }, "articleBody": "Всем доброй ночи. Изначально урок писался для светлой, но теперь думаю буду публиковать новые уроки сначала здесь. Сегодня мой день был потрачен не зря, ибо мне удалось написать свой первый небольшой плагин для нового RPG Maker MV. Сразу скажу, что ни разу не профессионал, занимаюсь в свободное от кухни время и только-только разбираюсь во всём это безобразии ", "mainEntityOfPage": "True" } </script> </head> <body onload="init();"> <div class="center"> <div class="header"> <div class="topLogo"></div> <div class="topMenuAdd"> <a href="/files/" class="topMenuItem" title="Файлы для скачивания"><i class="fas fa-download" aria-hidden="true"></i></a> <a href="/feed.xml" class="topMenuItem" title="Подписаться на RSS"><i class="fas fa-rss" aria-hidden="true"></i></a> </div> </div> <div id="navbar" class="topMenu"> <div class="topMenuLeft"></div> <div class="topMenuCenter"> <span class="topMenuSpace">&nbsp;</span> <span><a href="/blog/" class="topMenuItem active"><i class="fas fa-paw" aria-hidden="true"></i><br>Блог</a></span> <span><a href="/graphics/" class="topMenuItem"><i class="fas fa-pencil-alt" aria-hidden="true"></i><br>Графика</a></span> <span><a href="/misc/" class="topMenuItem"><i class="fas fa-code" aria-hidden="true"></i><br>Разное</a></span> <span><a href="/rpg_maker/" class="topMenuItem"><i class="fas fa-gem" aria-hidden="true"></i><br>RPG Maker</a></span> <span><a href="/godot/" class="topMenuItem"><i class="fas fa-cogs" aria-hidden="true"></i><br>Godot</a></span> <span><a href="/about/" class="topMenuItem"><i class="fab fa-github-alt" aria-hidden="true"></i><br>Мур?</a></span> </div> <div class="topMenuRight"></div> <a href="/"><div class="topMenuAvatar"></div></a> <div class="popupMenu"> <input id="popupMenuInput" type="checkbox" name="menu"/> <label id="popupMenuLabel" for="popupMenuInput"><span class="fa fa-bars topMenuIcon" aria-hidden="true"></span></label> <ul class="menu"> <li><a href="/blog/" class="popupMenuItem active"><i class="fas fa-paw" aria-hidden="true"></i>Блог</a></li> <li><a href="/graphics/" class="popupMenuItem"><i class="fas fa-pencil-alt" aria-hidden="true"></i>Графика</a></li> <li><a href="/misc/" class="popupMenuItem"><i class="fas fa-code" aria-hidden="true"></i>Разное</a></li> <li><a href="/rpg_maker/" class="popupMenuItem"><i class="fas fa-gem" aria-hidden="true"></i>RPG Maker</a></li> <li><a href="/godot/" class="popupMenuItem"><i class="fas fa-cogs" aria-hidden="true"></i>Godot</a></li> <li><a href="/about/" class="popupMenuItem"><i class="fab fa-github-alt" aria-hidden="true"></i>Мур?</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/comments/" class="popupMenuItem"><i class="far fa-comment-alt" aria-hidden="true"></i> Новые комментарии</a></li> <li><a href="https://murlab.disqus.com/latest.rss" class="popupMenuItem"><i class="fas fa-rss" aria-hidden="true"></i> RSS комментариев</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/archive/" class="popupMenuItem"><i class="fas fa-archive" aria-hidden="true"></i> Архив постов</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/files/" class="popupMenuItem"><i class="fas fa-download" aria-hidden="true"></i> Cкачать файлы</a></li> <li><div class="popupMenuLine"></div></li> <li><a href="/tags/" class="popupMenuItem"><i class="fas fa-tags" aria-hidden="true"></i> Все тэги</a></li> <li><a href="/feed.xml" class="popupMenuItem"><i class="fas fa-rss" aria-hidden="true"></i> RSS лента</a></li> </ul> </div> </div> <div class="content"> <div class="post"> <div class="postHeader"> <div class="postStar"><i class="fas fa-flask" aria-hidden="true"></i></div> <div class="postDate"> 5 Ноября 2015 </div> <div class="postTitle">Пишем свой первый плагин для RPG Maker MV</div> </div> <div class="postContent"> <div class="postImage"> <img src="/images.posts/2015.11/05 - Pishem svoj pervyj plagin dla RPG Maker MV/plugin_title.png" /> </div> <div class="postBody"> <p>Всем доброй ночи.</p> <p>Изначально урок писался для <a href="http://rpgmaker.ru/forum/fakultet-skriptov/60680-rmmv-pishem-svoj-pervyj-plagin/">светлой</a>, но теперь думаю буду публиковать новые уроки сначала здесь.</p> <p>Сегодня мой день был потрачен не зря, ибо мне удалось написать свой первый небольшой плагин для нового RPG Maker MV. Сразу скажу, что ни разу не профессионал, занимаюсь в свободное от кухни время и только-только разбираюсь во всём это безобразии</p> <p>Хотя есть некоторый опыт скриптоковыряния VX Ace, что конечно же мне помог и тут. В любом случае спешу поделится своими изысканиями и надеюсь они будут ещё полезны кому-нибудь.</p> <p>Начать мне хотелось бы с редактора. Как вы уже, наверное, заметили, в отличии от VX Ace в MV своего редактора нет. Скрипты лежат в открытом виде и можете спокойно их редактировать в любом текстовом редакторе. В одном из видеоуроков человек порекомендовал brackets. Опыта у меня не много в подобного рода редакторах, но мне понравился. Особенно очень удобно, когда начинаешь что-то писать, а тебе бац и сразу подсказки. Мелочь, а приятно. При желании можно выбрать удобную цветовую тему. Так что можете тоже попробовать <a href="http://brackets.io/">совершенно бесплатно</a>.</p> <p><img src="/images.posts/2015.11/05 - Pishem svoj pervyj plagin dla RPG Maker MV/brackets.png" class="imgCenter" /></p> <p>Для начала о том, что мы будем сегодня делать. Этот простой плагин рисует на экране небольшое окошко с иконкой и цифрой. Данные берутся из переменных (Variables) RPG Maker. А с помощью ключа (switch) можно включить или спрятать отображение данного окна. Теперь для чего? Например, NPC даёт герою задание, что нужно собрать 20 шишек. Понятно, что задание не сильно увеселительное, но можно игроку немного скрасить жизнь. Отображая, например, цифрами, сколько ему ещё осталось мучится. Выглядит это примерно так:</p> <p><img src="/images.posts/2015.11/05 - Pishem svoj pervyj plagin dla RPG Maker MV/screenshot_01.png" class="imgCenter" /></p> <p>Для того, чтобы пользователь мог выбрать произвольные ячейки (Variables) и ключ (Switch) для отображения, мы выведем эти параметры в настройки нашего плагина. В принципе можно вынести и размер окна, и его положение на экране, но мне бы пока не хотелось так всё сразу запутывать.</p> <p>Итак, создадим новый файл ItemOnMap.js в папке нашего проекта, а именно js\plugins. Этого уже достаточно, чтобы он уже появился в списке доступных плагинов, однако всё же стоит добавить его описание:</p><pre><code class="javascript">//=============================================================================
// ItemOnMap.js
//=============================================================================
</code></pre><p>Здесь название нашего файла. Не могу сказать, что это нужно наверняка, но во всех плагинах под MV примерно такое-же оформление. Возможно система поэтому определяет, что это именно наш плагин, а ни чей-нибудь ещё.</p><pre><code class="javascript">/*:
</code></pre><p>Открываем комментарий и описываем различные параметры:</p><pre><code class="javascript">* @plugindesc отображает на экране количество предметов в ячейке
* @author Mur
*
</code></pre><p>Далее указывается описание плагина (@plugindesc) и собственно кто автор (@author)</p><pre><code class="javascript">* @param enableSwitchId
* @desc показать/скрыть (номер ключа)
* @default 1
*
</code></pre><p>Затем следуют перечисления параметров нашего плагина. Тут надо быть очень внимательными, ибо эти название затем используются в скрипте. И если что-то напутать, ничего не получится. Один параметр состоит из трёх частей, собственно его названия @param (на английском языке и честно не знаю, можно ли писать на русском), описание данного параметра @desc (не знаю почему, но описание на русском не отображается) и значение по умолчанию @default. Данный параметр указывает какой ключ (switch) будет разрешать или запрещать отображение данного окошка.</p><pre><code class="javascript">* @param itemVarId
* @desc Иконка предмета (номер переменной)
* @default 1
*
</code></pre><p>Здесь указывает номер переменной (Variable) в которой хранится номер предмета, который должен собирать наш главный герой. Иконка этого предмета и отображается в нашем окошке.</p><pre><code class="javascript">* @param countVarId
* @desc Количество предметов (номер переменной)
* @default 2
</code></pre><p>Ну и завершает это всё последний параметр, который так же указывает на номер переменной (Variable) в которой хранится количество собранных предметов.</p><pre><code class="javascript">*/</code></pre><p>Закрываем комментарий и далее следует уже наш скрипт самого плагина.</p><pre><code class="javascript">(function() {</code></pre><p>Такой строчкой начинаются почти все плагины, которая собственно и сообщает системе, что сейчас мы будет творить!</p><pre><code class="javascript">var parameters = PluginManager.parameters('ItemOnMap');
</code></pre><p>Для начала нам нужно добраться до настроек нашего плагина. Не знаю, как это всё связано, но обратите внимание, что наш файл, первый кусочек и здесь название плагина везде одинаковое, в данном случае это «ItemOnMap».</p><pre><code class="javascript">var enableSwitchId = Number(parameters['enableSwitchId']);
var itemVarId = Number(parameters['itemVarId']);
var countVarId = Number(parameters['countVarId']);
</code></pre><p>Здесь мы получаем значение наших параметров. Честно не знаю, зачем тут написано Number, но в других скриптах сделано так же, так что видимо так надо.</p> <p>А так это выглядит, когда мы подключаем наш плагин:</p> <p><img src="/images.posts/2015.11/05 - Pishem svoj pervyj plagin dla RPG Maker MV/params.png" class="imgCenter" /></p><pre><code class="javascript">//Обновление всех окон
var _Scene_Map_createAllWindows = Scene_Map.prototype.createAllWindows;
Scene_Map.prototype.createAllWindows = function() {
	_Scene_Map_createAllWindows.call(this);
	this._itemOnMap = new ItemOnMap(10,10, 120, 60);
	this.addWindow(this._itemOnMap);
};
</code></pre><p>Вот тут очень важный и сложный момент. Для того, чтобы наше окно постоянно отображалось. Нам нужно втиснутся в основную функцию создания всех окон (createAllWindows). Если вы писали скрипты (или хотя бы пытались что-то изменить в чужих, как я, например) под VX Ace, то наверняка заметили схожий приём. Когда главная функция системы подменялась на нашу, а потом вызывалась внутри с такими же параметрами. Ну не суть важно, я думаю если кому интересно он спросит у знатоков, а тут просто для пояснения.</p> <p>Сначала создаём «копию» основной функции системы:</p><pre><code class="javascript">var _Scene_Map_createAllWindows = Scene_Map.prototype.createAllWindows;
</code></pre><p>Затем заменяем её уже своей функцией:</p><pre><code class="javascript">Scene_Map.prototype.createAllWindows = function() {
</code></pre><p>внутри которой вызываем настоящую, что бы ничего не поломалось:</p><pre><code class="javascript">	_Scene_Map_createAllWindows.call(this);
</code></pre><p>И затем уже добавляем создание нашего окошка:</p><pre><code class="javascript">	this._itemOnMap = new ItemOnMap(10,10, 120, 60);
</code></pre><p>Первые два числа — это координаты где на экране будет наше окно, а два другие его соответственно ширина и высота.</p><pre><code class="javascript">	this.addWindow(this._itemOnMap);
}
</code></pre><p>Затем это окно добавляется в систему и далее собственно уже функции нашего окна:</p><pre><code class="javascript">function ItemOnMap() {
	this.initialize.apply(this, arguments);
}
</code></pre><p>Честно скажу, назначение этого кусочка мне до конца не ясно. Однако сразу скажу, что без него не работает и кроме того опять же очень важно название — «ItemOnMap»!! Оно идёт везде одинаковое, ошибётесь на 1 букву будут ошибки.</p><pre><code class="javascript">ItemOnMap.prototype = Object.create(Window_Base.prototype);
ItemOnMap.prototype.constructor = ItemOnMap;
</code></pre><p>Дальше, если я правильно понимаю, копируются все параметры, свойства и собственно функции отрисовки системного окна в наш ItemOnMap. Дальше мы можем в нём менять всё что душе угодно, не боясь, что это отобразиться свойствах всех остальных окошек.</p><pre><code class="javascript">ItemOnMap.prototype.standardPadding = function() {
	return 0;
};
</code></pre><p>Например, вот, по умолчанию отступ у всех окон 18px. Для того что бы наш текст и иконка были видны его стоит задать равным 0.</p><pre><code class="javascript">ItemOnMap.prototype.initialize = function(x, y, width, height) {
Window_Base.prototype.initialize.call(this, x, y, width, height);
	this._id = 1;
};
</code></pre><p>Далее, как я понимаю идёт инициализация нашего окна, с такими же параметрами как у главного.</p> <p>Ну и самое интересное. Окно появилось, и остаётся только вывести в него информацию:</p><pre><code class="javascript">ItemOnMap.prototype.update = function() {
</code></pre><p>Для этого необходимо в функции update написать то, что мы хотим вывести в нашем окне.</p><pre><code class="javascript">	this.contents.clear();
</code></pre><p>Для начала его надо очистить, если этого не сделать всё будет накладываться друг на дружку и в конце концов будет выглядеть ужасно.</p><pre><code class="javascript">	if ($gameSwitches.value(enableSwitchId)) {
</code></pre><p>Далее мы проверяем, разрешено ли показывать наше окно, если да, то:</p><pre><code class="javascript">		this.show();
</code></pre><p>Покажем окно</p><pre><code class="javascript">		this.resetTextColor();
</code></pre><p>Установим настройки (цвет, размер) текста по умолчанию</p><pre><code class="javascript">		var itemId = $gameVariables.value(itemVarId);
</code></pre><p>Берём номер предмета, который нужно отобразить:</p><pre><code class="javascript">		if (itemId == 0) {
			itemId = 1;
		}
</code></pre><p>Проверяем, что бы он не был равен 0, иначе будет ошибка.</p><pre><code class="javascript">		this.drawIcon($dataItems[itemId].iconIndex, 15, 15);
</code></pre><p>Рисуем нашу иконку. $dataItems[itemId].iconIndex номер иконки предмета, и две последующие цифры это координаты x,y внутри нашего окна.</p><pre><code class="javascript">		this.drawTextEx(":" + $gameVariables.value(countVarId), 52, 15);
</code></pre><p>Далее выводим наше число из переменной, и опять же два последующих числа это координаты x,y внутри нашего окна, но только уже для вывода текста.</p><pre><code class="javascript">	} else {
</code></pre><p>Если же показывать окно нельзя, то</p><pre><code class="javascript">		this.hide();
</code></pre><p>Скроем его и закончим данную функцию.</p><pre><code class="javascript">	}
}
</code></pre><p>Собственно, на этом всё, остаётся только не забыть закончить главную функцию плагина:</p><pre><code class="javascript">})();
</code></pre><p>Как видите ничего сложного почти нет. Хотя по правде говоря было очень непросто сходу разобраться со всем этим, и, если бы не потраченные дни предварительного разбирания и ковыряния VX Ace, мне бы не удалось это всё сделать так «быстро». Однако надо сказать огромное спасибо авторам, что так же как в VX Ace, RMMV название функций и переменных очень схожи, что конечно хоть и не сильно, но всё же упрощает написание плагинов под RMMV.</p> <p>Если вдруг будут какие-то вопросы, постараюсь в меру своих сил ответить.</p> <p>p.s. огромное спасибо всем, кто мне помогал и помогает разбираться с премудростями RPG Maker, как здесь на форуме, так и в нашем горячо любимом чатике. Как видите мои глупые вопросы наконец вылились во что-то если не серьёзное, так во что-то не плохое это точно.</p> <p> Небольшое дополнение:</p> <div class="hline"></div> <p>Если необходимо, что бы окно так же отображалось во время боя, то для этого достаточно перед строчкой «function ItemOnMap() {»</p> <p>Добавить, по аналогии с «_Scene_Map_createAllWindows»:</p><pre><code class="javascript">//Обновление окон во время битвы
var _Scene_Battle_createAllWindows = Scene_Battle.prototype.createAllWindows;
Scene_Battle.prototype.createAllWindows = function() {
	_Scene_Battle_createAllWindows.call(this);
	this._itemOnMap = new ItemOnMap(10,10, 120, 60);
	this.addWindow(this._itemOnMap);
};
</code></pre><p>Правда появятся небольшие проблемы:</p> <p><img src="/images.posts/2015.11/05 - Pishem svoj pervyj plagin dla RPG Maker MV/items_on_map.png" class="imgCenter" /></p> <p>Наше окошко будет перекрывать системные сообщения о битве. Поэтому нужно указать где-то другое место.</p> <p><strong> Ссылки по теме</strong>:</p> <div class="hline"></div> <ul> <li>Готовый <a href="https://yadi.sk/d/j7MrpQHK3GZNun">пример проекта</a> с использованием вышеописанного плагина.</li> <li>Свежая версия скрипта <a href="https://github.com/murlab/rpg-maker-mv-plugins/blob/master/examples/ItemOnMap.js">ItemOnMap.js</a> всегда доступна на github в разделе <a href="https://github.com/murlab/rpg-maker-mv-plugins/blob/master/examples/">примеров</a></li> </ul> <div class="postTags"> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/archive/">archive</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/rpg maker mv/">rpg maker mv</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/plugins/">plugins</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/javascript/">javascript</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/story/">story</a></div> <div class="postTag"><i class="fa fa-tag" aria-hidden="true"></i> <a href="/tags/uroki/">уроки</a></div> </div> </div> <div class="postEnd"> <div class="postEndLineStart"></div> <div class="postEndCont"><a href="javascript:history.back();"><< Назад</a></div> <div class="postEndLineFinish"></div> </div> </div> <div id="disqus_thread"></div> <script> (function() { var d = document, s = d.createElement('script'); s.src = 'https://murlab.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> <div class="centerClean"></div> </div> </div> <div class="centerEnd"><div></div></div> <div class="footer">2014, 2019 &copy; Mur Laboratory. Размещение материалов на других ресурсах только с разрешения автора.</div> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111024724-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-111024724-1'); </script> </body> </html>
